var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function a(e){try{h(o.next(e))}catch(t){r(t)}}function s(e){try{h(o["throw"](e))}catch(t){r(t)}}function h(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(a,s)}h((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(i)throw new TypeError("Generator is already executing.");for(;h;)try{if(i=1,r&&(a=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,r=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(a=h.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){h.label=n[1];break}if(6===n[0]&&h.label<a[1]){h.label=a[1],a=n;break}if(a&&h.label<a[2]){h.label=a[2],h.ops.push(n);break}a[2]&&h.ops.pop(),h.trys.pop();continue}n=t.call(e,h)}catch(o){n=[6,o],r=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,r,a,s,h={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},SceneModel=function(e){function t(){var t=e.call(this)||this;return t.tankDamage={red:10,blue:20,green:25},t}return __extends(t,e),t}(eui.Component);__reflect(SceneModel.prototype,"SceneModel");var enemyTypes;!function(e){e[e.hay=0]="hay",e[e.grass=1]="grass"}(enemyTypes||(enemyTypes={}));var Obstacle=function(e){function t(t){var n=e.call(this)||this;return n.ObstacleList={hay:{hp:100,canShoot:!0},grass:{hp:0,canShoot:!1}},n.x=t.x,n.y=t.y,n.type=t.type,n.name=enemyTypes[t.type],n.source=enemyTypes[t.type]+"_png",n.hp=n.ObstacleList[n.name].hp,n.canShoot=n.ObstacleList[n.name].canShoot,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n}return __extends(t,e),t.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)},t.produce=function(e){null==t._pool[e.type]&&(t._pool[e.type]=[]);var n,o=t._pool[e.type];return o.length>0?(n=o.pop(),n.x=e.x,n.y=e.y,n.type=e.type,n.name=enemyTypes[e.type],n.hp=n.ObstacleList[n.name].hp,n.canShoot=n.ObstacleList[n.name].canShoot,n.source=enemyTypes[e.type]+"_png"):n=new t(e),n},t.reclaim=function(e){null==t._pool[e.type]&&(t._pool[e.type]=[],console.log(t._pool[e.type]));var n=t._pool[e.type];-1==n.indexOf(e)&&n.push(e)},t.prototype.clearItme=function(){this.parent&&(t.reclaim(this),this.parent.removeChild(this))},t._pool={},t}(eui.Image);__reflect(Obstacle.prototype,"Obstacle");var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function o(o){t.call(n,o,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?o(i):RES.getResAsync(e,o,this)}else RES.getResByUrl(e,o,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var GameCenter=function(){function e(){}return e.sceneModel=new SceneModel,e}();__reflect(GameCenter.prototype,"GameCenter");var Platform=function(){function e(){}return e}();__reflect(Platform.prototype,"Platform",["ApiPlatform"]);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,n,o){function i(e){t.call(o,e)}function r(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),n.call(o))}var a=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(o,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(o,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var h=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(o,generateJSON.paths[e])},this):RES.getResByUrl(h,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(o,generateJSON.paths[e])},a)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(o,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var game;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.speed=10,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.init()},n.prototype.init=function(){var t=RES.getRes("bg_png");this.textureWidth=t.textureWidth,this.textureHeight=t.textureHeight,this.rowCount=Math.ceil(this.stageW/this.textureWidth)+2,this.colCount=Math.ceil(this.stageH/this.textureHeight)+2,this.bmpArr=[];for(var n=0;n<this.rowCount;n++){for(var o=[],i=void 0,r=0;r<this.colCount;r++)i=e.createBitmapByName("bg_png"),i.x=this.textureWidth*n,i.y=this.textureHeight*r,o.push(i),this.addChild(i);this.bmpArr.push(o)}this.x=(this.stageW-this.width)/2,this.y=(this.stageH-this.height)/2},n.prototype.enterFrameHandler=function(e,t){var n=e;if("up"==n||"down"==n){this.y+=this.speed,GameCenter.gameContainer.obstacleList.y+=this.speed;for(var o=0;o<this.rowCount;o++){var i=this.bmpArr[o];if("down"==n&&this.y<-1*(i[0].y+this.textureHeight)){i[0].y=i[this.colCount-1].y+this.textureHeight;var r=i.shift();this.bmpArr[o].push(r)}if("up"==n&&this.y>-1*(i[0].y+this.textureHeight)){i[this.colCount-1].y=-(this.textureHeight-i[0].y);var r=i.pop();this.bmpArr[o].unshift(r)}}}else{this.x+=this.speed,GameCenter.gameContainer.obstacleList.x+=this.speed;for(var i=this.bmpArr,o=0;o<this.colCount;o++)"right"==n&&this.x<-1*(i[0][o].x+this.textureWidth)&&(i[0][o].x=i[this.rowCount-1][o].x+this.textureWidth);if("right"==n){var r=this.bmpArr.shift();this.bmpArr.push(r)}}},n.prototype.start=function(e,t){void 0===t&&(t=0),t=Math.abs(t),this.speed="left"==e||"up"==e?t:-t,this.enterFrameHandler(e,t)},n}(egret.DisplayObjectContainer);e.BgMap=t,__reflect(t.prototype,"game.BgMap")}(game||(game={}));var game;!function(e){var t=function(e){function t(t){var n=e.call(this)||this;return n.x=t.x,n.y=t.y,n.rotation=t.rotation,n.source="bullet_png",n.anchorOffsetX=n.anchorOffsetY=.5,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n}return __extends(t,e),t.prototype.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)},t.produce=function(e){var n,o=t._bullet;return o.length>0?(n=o.pop(),n.x=e.x,n.y=e.y,n.rotation=e.rotation,n.source="bullet_png"):n=new t(e),n},t.reclaim=function(e){var n=t._bullet;-1==n.indexOf(n)&&n.push(e)},t.prototype.clearItme=function(){this.parent&&(t.reclaim(this),this.parent.removeChild(this))},t.prototype.shooting=function(e){var t=this;this.tik=setInterval(function(){var n,o;0==e&&(n=t.y,o=0,t.y-=60),90==e&&(n=t.x,o=GameCenter.sceneRoot.stage.stageWidth,t.x+=60),180==e&&(n=t.y,o=GameCenter.sceneRoot.stage.stageHeight,t.y+=60),-90==e&&(n=t.x,o=0,t.x-=60),t.fly(n,o)},100)},t.prototype.fly=function(e,t){var n=GameCenter.gameContainer.isHitCanShoot(this);n&&this.boomFinish(),0==t&&t>e&&(clearInterval(this.tik),this.clearItme()),0!=t&&e>t&&(clearInterval(this.tik),this.clearItme())},t.prototype.boomFinish=function(){var e=this;clearInterval(this.tik),this.source="boom_03_png",setTimeout(function(){e.clearItme()},200)},t._bullet=[],t}(eui.Image);e.Bullet=t,__reflect(t.prototype,"game.Bullet")}(game||(game={}));var game;!function(e){var t=function(e){function t(t){var n=e.call(this)||this;return n.posList={up:[200,-130],down:[200,10],right:[330,-50],left:[70,-50],attank:[GameCenter.sceneRoot.stage.stageWidth-200,-20],change:[GameCenter.sceneRoot.stage.stage.stageWidth-200,-170]},n.source=t+"_png",n.name=""+t,n.x=n.posList[t][0],n.y=n.posList[t][1],n.direction=t,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n}return __extends(t,e),t.prototype.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)},t}(eui.Image);e.Button=t,__reflect(t.prototype,"game.Button")}(game||(game={}));var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},egret.registerImplementation("eui.IAssetAdapter",new AssetAdapter),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),GameCenter.sceneRoot=this,this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return n.sent(),[4,this.loadTheme()];case 3:return n.sent(),this.stage.removeChild(e),[3,5];case 4:return t=n.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var o=new eui.Theme("resource/default.thm.json",e.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){return t()},e)})},t.prototype.createGameScene=function(){var e=new game.Scene,t=e.viewInit();t&&game.init()},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var game;!function(e){var t=function(t){function n(e){var n=t.call(this)||this;return n.speed=10,n.colorList=["red","blue","green"],n.color=e,n.damage=GameCenter.sceneModel.tankDamage[n.color],n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n}return __extends(n,t),n.prototype.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.source="tank_"+this.color+"_png",this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2},n.prototype.setTankColor=function(){var e=this.colorList.indexOf(this.color);this.color=e+1>2?this.colorList[0]:this.colorList[e+1],this.damage=GameCenter.sceneModel.tankDamage[this.color],this.source="tank_"+this.color+"_png",console.log("更換坦克 顏色:"+this.color+", 火力:"+this.damage)},n.prototype.canMove=function(){return __awaiter(this,void 0,void 0,function(){var t,n,o;return __generator(this,function(i){switch(i.label){case 0:t=!0,n=GameCenter.gameContainer.poolArr.length-1,i.label=1;case 1:return n>=0?(o=GameCenter.gameContainer.poolArr[n],[4,e.hitTest(o,this)]):[3,4];case 2:if(i.sent())return t=!1,[3,4];i.label=3;case 3:return n--,[3,1];case 4:return[2,t]}})})},n}(eui.Image);e.Tank=t,__reflect(t.prototype,"game.Tank")}(game||(game={}));var game;!function(e){function t(){mouse.enable(GameCenter.sceneRoot.stage),this.setGameKeyboard();var e=GameCenter.sceneModel;e&&GameCenter.sceneRoot.addChild(e)}function n(){}function o(){document.addEventListener("keydown",function(e){switch(e.keyCode){case 37:GameCenter.gameContainer.setButtonEvent("left");break;case 38:GameCenter.gameContainer.setButtonEvent("up");break;case 39:GameCenter.gameContainer.setButtonEvent("right");break;case 40:GameCenter.gameContainer.setButtonEvent("down");break;case 13:GameCenter.gameContainer.changTankColor();break;case 32:GameCenter.gameContainer.shootBullet()}})}function i(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t}function r(){AnimationDB.initDB()}function a(e,t){var n=!1,o=e.$hitTest(t.x,t.y);return n=o?!0:!1}e.init=t,e.setControltPanel=n,e.setGameKeyboard=o,e.createBitmapByName=i,e.animation=r,e.hitTest=a}(game||(game={}));var game;!function(e){var t=function(){function t(){}return t.prototype.viewInit=function(){return GameCenter.gameContainer||(GameCenter.gameContainer=new e.GameContainer,GameCenter.gameContainer.width=GameCenter.sceneRoot.stage.stageWidth,GameCenter.gameContainer.height=GameCenter.sceneRoot.stage.stageHeight,GameCenter.sceneModel.addChild(GameCenter.gameContainer)),!0},t}();e.Scene=t,__reflect(t.prototype,"game.Scene")}(game||(game={}));var game;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e.colorList=["red","blue","green"],e.controlList=["up","down","left","right","attank","change"],e.emenyInit=30,e.scoreText=0,e.tweenArr=[],e.poolArr=[],e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(n,t),n.prototype.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.createGameScene()},n.prototype.createGameScene=function(){this.setView(),this.createControl(),egret.startTick(this.updata,this),this.tickTime=egret.getTimer();for(var e=0;e<this.emenyInit;e++)this.createEnemy()},n.prototype.setView=function(){this.moveBg=new eui.Group,this.addChild(this.moveBg),this.bg=new e.BgMap,this.moveBg.addChild(this.bg),this.tank=new e.Tank("red"),this.tank.x=this.stage.stageWidth/2,this.tank.y=this.stage.stageHeight/2,this.addChild(this.tank),this.obstacleList=new eui.Group,this.moveBg.addChild(this.obstacleList),this.controlPanel=new eui.Group,this.controlPanel.y=this.stage.stageHeight-200,this.addChild(this.controlPanel),this.scoreLabel=new eui.Label,this.scoreLabel.textColor=0,this.scoreLabel.x=20,this.scoreLabel.y=10,this.addChild(this.scoreLabel),this.timeLabel=new eui.Label,this.timeLabel.textColor=0,this.timeLabel.x=this.stage.stageWidth-180,this.timeLabel.y=10,this.addChild(this.timeLabel)},n.prototype.createControl=function(){var t=this;this.controlList.forEach(function(n){var o=new e.Button(n);t.buttonListener(o),t.controlPanel.addChild(o)})},n.prototype.updateScoreText=function(){this.scoreLabel.text="score:"+this.scoreText},n.prototype.createEnemy=function(){var e=Math.floor(2*Math.random()),t=Math.floor(Math.random()*this.bg.width+1),n=Math.floor(Math.random()*this.bg.height+1);t=Math.max(t,0),t=Math.min(t,this.bg.width-320),n=Math.max(n,0),n=Math.min(n,this.bg.height-320);var o=Obstacle.produce({x:t,y:n,type:e});this.isHitGourpItem(o)?Obstacle.reclaim(o):(this.obstacleList.addChildAt(o,this.numChildren-10),this.poolArr.push(o))},n.prototype.updata=function(e){return this.timeLabel.text="time : "+Math.floor(e/1e3),e-this.tickTime>=5e3&&(this.tickTime=e,this.createEnemy()),!1},n.prototype.isHitGourpItem=function(t){for(var n=!1,o=this.poolArr.length-1;o>=0;o--){var i=this.poolArr[o];if(e.hitTest(i,t)){n=!0;break}if(e.hitTest(t,this.tank)){n=!0;break}}return n},n.prototype.isHitCanShoot=function(t){for(var n=!1,o=this.poolArr.length-1;o>=0;o--){var i=this.poolArr[o];if(e.hitTest(i,t)){i.canShoot&&(i.hp-=this.tank.damage,i.hp<=0&&i.clearItme()),n=!0;break}}return n},n.prototype.shootBullet=function(){var t,n,o=this.tank.rotation;90==o?(t=this.tank.x+this.tank.width-30,n=this.tank.y-6):180==o?(t=this.tank.x+6,n=this.tank.y+this.tank.height-30):-90==o?(t=this.tank.x-this.tank.width+30,n=this.tank.y+this.tank.height/2-38):(t=this.tank.x-6,n=this.tank.y-this.tank.height/2-10);var i=e.Bullet.produce({x:t,y:n,rotation:o});this.addChild(i),i.shooting(o)},n.prototype.getTankPosition=function(e){return this.tank[e]},n.prototype.moveTank=function(e,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return this.tank[e]=this.tank[e]+t,[4,this.tank.canMove()];case 1:return n.sent()||(this.tank[e]=this.tank[e]-t),[2]}})})},n.prototype.changTankColor=function(){this.tank.setTankColor()},n.prototype.setTankrotationAngle=function(e){this.tank.rotation=e},n.prototype.setButtonEvent=function(e){var t="left"==e||"right"==e?"x":"y",n={left:-90,up:0,right:90,down:180};("left"==e||"up"==e)&&this.getTankPosition(t)>=300?this.moveTank(t,-30):"right"==e&&this.getTankPosition(t)<=GameCenter.sceneRoot.stage.stageWidth-300?this.moveTank(t,30):"down"==e&&this.getTankPosition(t)<=780?this.moveTank(t,30):this.bg.start(e,10),this.setTankrotationAngle(n[e])},n.prototype.buttonListener=function(e){if("change"==e.name||"attank"==e.name){var t=e.name+"BtnListener";this[t](e)}else e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setButtonEvent.bind(this,e.name),this)},n.prototype.changeBtnListener=function(e){e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.changTankColor,this)},n.prototype.attankBtnListener=function(e){e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.shootBullet,this)},n}(egret.DisplayObjectContainer);e.GameContainer=t,__reflect(t.prototype,"game.GameContainer")}(game||(game={}));var GameModel=function(){function e(){}return e.gameName="Tank-demo",e}();__reflect(GameModel.prototype,"GameModel");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.text=new eui.Label,this.addChild(this.text),this.text.textAlign="center",this.text.horizontalCenter="430",this.text.verticalCenter="250",this.text.textAlign="center"},t.prototype.onProgress=function(e,t){this.text.text="Loading ... "+e+"/"+t},t}(eui.Component);__reflect(LoadingUI.prototype,"LoadingUI",["eui.UIComponent","egret.DisplayObject"]);var AnimationDB=function(){function e(){}return e.initDB=function(){var e=["boom","shot"];e.forEach(function(e){var t=RES.getRes(e+"_ske_json"),n=RES.getRes(e+"_tex_json"),o=RES.getRes(e+"_tex_png");dragonBones.EgretFactory.factory.parseDragonBonesData(t),dragonBones.EgretFactory.factory.parseTextureAtlasData(n,o)})},e.playDB=function(e,t,n,o,i,r,a){void 0===a&&(a=1);var s=n;s["armatureDisplay_"+e]||(s["armatureDisplay_"+e]=dragonBones.EgretFactory.factory.buildArmatureDisplay(t),s["armatureDisplay_"+e].addEventListener(dragonBones.EventObject.COMPLETE,function(){s["armatureDisplay_"+e].parent.removeChild(s["armatureDisplay_"+e])},this)),s["armatureDisplay_"+e].parent||n.addChild(s["armatureDisplay_"+e]),s["armatureDisplay_"+e].x=o[0],s["armatureDisplay_"+e].y=o[1],s["armatureDisplay_"+e].animation.timeScale=i||1,r?s["armatureDisplay_"+e].animation.play():s["armatureDisplay_"+e].animation.play(null,a)},e.boom=function(t,n){e.playDB("boom","boom",t,n,1,!1)},e.shot=function(t,n){e.playDB("shot","shot",t,n,1,!1)},e}();__reflect(AnimationDB.prototype,"AnimationDB");var GameKeyboard=function(){function e(e){this.events=[],this.disabled=!1,this.preKeys=[],this.keys=[],this.keyValue=keyboardValue,this.deltaTime=15,this.deltaTime=e||15,this.init()}return e.prototype.init=function(){document.onkeydown=this.onKeyDown.bind(this),document.onkeyup=this.onKeyUp.bind(this)},e.prototype.addEvent=function(e){return e.id=Math.random(),this.events.push(e),console.log("addEvent",e.id,this.events),e.id},e.prototype.removeEvent=function(e){var t=this.events.findIndex(function(t){return t.id===e});-1!==t&&this.events.splice(t,1),console.log("removeEvent",this.events,t)},e.prototype.onKeyDown=function(e){if(this){var t=e||window.event||arguments.callee.caller.arguments[0];this.handleKeyDown(t),this.removeTimer(),this.keys.length>0&&(this.disabled||this.dispatchEventWith(KeyBoardType.onkeydown),this.preKeys=this.keys,this.timer=setInterval(function(){this.disabled||this.dispatchEventWith(KeyBoardType.onkeydown,!0,this.keys,!0),this.preInputs=this.inputs}.bind(this),this.deltaTime))}},e.prototype.onKeyUp=function(e){if(this){var t=e||window.event||arguments.callee.caller.arguments[0];this.handleKeyUp(t),this.keys.length>0?(this.disabled||this.dispatchEventWith(KeyBoardType.onkeyup),this.preKeys=this.keys):(this.removeTimer(),this.preKeys=[])}},e.prototype.dispatchEventWith=function(e){var t=this.events[this.events.length-1];t&&(e===KeyBoardType.onkeydown?t.onKeyDown&&t.onKeyDown(this.keys,this.preKeys):e===KeyBoardType.onkeyup&&t.onKeyUp&&t.onKeyUp(this.keys,this.preKeys))},e.prototype.removeTimer=function(){this.timer&&clearInterval(this.timer)},e.prototype.handleKeyDown=function(e){for(var t in this.keyValue)parseInt(t)===e.keyCode&&this.checkInput(this.keyValue[t])},e.prototype.handleKeyUp=function(e){for(var t in this.keyValue)parseInt(t)===e.keyCode&&this.removeByKey(this.keyValue[t])},e.prototype.checkInput=function(e){for(var t=!1,n=0;n<this.keys.length;n++)this.keys[n]==e&&(t=!0);t||this.keys.push(e)},e.prototype.removeByKey=function(e){for(var t=0;t<this.keys.length;t++)this.keys[t]==e&&this.keys.splice(t,1)},e.prototype.isContain=function(e,t){for(var n=!1,o=0;o<e.length;o++)e[o]==t&&(n=!0);return n},e.prototype.getPreKeys=function(){return this.preKeys},e.prototype.changeDisabled=function(e){this.disabled=e},e}();__reflect(GameKeyboard.prototype,"GameKeyboard");var KeyBoardType={onkeydown:"KeyBoardonkeydown",onkeyup:"KeyBoardonkeyup",ENTER:"ENTER",SPACE:"SPACE",UpArrow:"up",keyArrow:"left",DownArrow:"down",RightArrow:"right"},keyboardValue={13:KeyBoardType.ENTER,32:KeyBoardType.SPACE,37:KeyBoardType.keyArrow,38:KeyBoardType.UpArrow,40:KeyBoardType.DownArrow,39:KeyBoardType.RightArrow};